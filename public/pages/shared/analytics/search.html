<div ng-controller="analytics:search">

  <div class="row">
    <form class="form-horizontal" ng-submit="doSearch()">

      <div class="col-md-11">
        <label class="control-label">search {{ section }} by key (use * for wildcards):</label>
        <input type="text" class="form-control" ng-model="query" placeholder="email:evan@messagebot.com, firstName:evan">
      </div>

      <div class="col-md-1">
        <label class="control-label">&nbsp;</label>
        <button type="submit" class="form-control btn btn-primary">search</button>
      </div>

    </form>
  </div>

  <div ng-if="searchResults.length > 0" class="col-md-12" ng-include="'pages/shared/analytics/histogram.html'"></div>
  <div ng-if="searchResults.length > 0" class="col-md-12" ng-include="'pages/shared/analytics/heatmap.html'"></div>

  <div class="row" ng-if="searchResults.length > 0">
    <div class="col-md-12">
      <h2>Search Results ({{ total }} total):</h2>

      <table class="table table-striped table-hover">

        <thead>
          <tr>
            <th>&nbsp;</th>
            <th>guid</th>
            <th>createdAt</th>
            <th>updatedAt</th>
            <th ng-if="searchResults[0].source !== undefined">source</th>
            <th ng-if="searchResults[0].type !== undefined">type</th>
            <th ng-if="searchResults[0].transport !== undefined">transport</th>
            <th>data</th>
          </tr>
        </thead>

        <tbody ng-repeat="record in searchResults">
          <tr>
            <td><a href="/#/{{ recordType }}/{{ record.guid  }}"><span class="glyphicon glyphicon-pencil">&nbsp;</span></a></td>
            <td>{{ record.guid }}</td>
            <td>{{ record.createdAt }}</td>
            <td>{{ record.updatedAt }}</td>
            <td ng-if="record.source !== undefined">{{ record.source }}</td>
            <td ng-if="record.type !== undefined">{{ record.type }}</td>
            <td ng-if="record.transport !== undefined">{{ record.transport }}</td>
            <td>{{ record.data }}</td>
          </tr>
        </tbody>

      </table>
    </div>
  </div>

  <ul class="pagination pagination-sm" ng-if="searchResults.length > 0">
    <li ng-class="pagination.showBack ? '' : 'disabled'" ><a href="/#/{{ section }}/search/{{ query }}/{{ pagination.firstPage }}">&laquo;</a></li>

    <li ng-repeat="p in pagination.pages" ng-class="p.active ? 'active' : ''">
      <a href="/#/{{ section }}/search/{{ query }}/{{ p.page }}">{{ p.page }}</a>
    </li>

    <li ng-class="pagination.showForward ? '' : 'disabled'"><a href="/#/{{ section }}/search/{{ query }}/{{ pagination.lastPage }}">&raquo;</a></li>
  </ul>

</div>
