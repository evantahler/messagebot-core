<div ng-controller="campaign:edit">

  <row>
    <div class="col-md-12">
      <h1>Campaign: <input type="text" ng-model="campaign.name"></h1>
      <h2 class="text-success" ng-if="campaign.sentAt">Sent At: {{ campaign.sentAt.toString() }}</h2>
      <p><input size="50" type="text" ng-model="campaign.description"></p>
      <p>
        This is a
        <select name="type" ng-model="campaign.type">
          <option ng-repeat="t in types" value="{{t}}">{{t}}</option>
        </select>
        campaign using the
        <select name="listId" ng-model="campaign.listId">
          <!--  I don't know why the parseInt() is required here... but it is! -->
          <option ng-repeat="l in lists" value="{{l.id}}" ng-selected="parseInt(campaign.listId) === parseInt(l.id)">{{l.folder}} / {{l.name}}</option>
        </select>
        list and
        <select name="templateId" ng-model="campaign.templateId">
          <option ng-repeat="t in templates" value="{{t.id}}" ng-selected="parseInt(campaign.templateId) === parseInt(t.id)">{{t.folder}} / {{t.name}}</option>
        </select>
        template.
      </p>

      <p>This list currently will send to {{ list.peopleCount }} people</p>

      <a ng-click="editCampaign();" class="btn btn-primary">Save</a>
      <a ng-click="deleteCampaign();" class="btn btn-danger">Delete</a>

      <hr />

      <row>
        <div class="col-md-6">

          <h2>Campaign Variables:</h2>

            <table class="table table-striped table-hover">

              <thead>
                <tr>
                  <th>key</th>
                  <th>value</th>
                </tr>
              </thead>

              <tbody ng-repeat="campaignVariable in transport.campaignVariables">
                <tr>
                  <td>{{ campaignVariable }}</td>
                  <td>
                    <span class="glyphicon glyphicon-edit">&nbsp;</span><input ng-model="campaign.campaignVariables[campaignVariable]" type="text" style="width:90%" >
                  </td>
                </tr>
              </tbody>

            </table>

          </div>

          <div class="col-md-6">

          <div ng-if="campaign.type === 'simple'">
            <h2>Options for a Simple Campaign:</h2>

            <label for="select" class="control-label">Send At</label>
            <div class="dropdown">
              <a class="dropdown-toggle" id="sendAt" role="button" data-toggle="dropdown">
                <div class="input-group">
                  <input type="text" class="form-control" ng-model="campaign.sendAt"><span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                </div>
              </a>
              <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                <datetimepicker ng-model="campaign.sendAt" data-datetimepicker-config="{ dropdownSelector: '#sendAt' }"/>
              </ul>
            </div>
          </div>

          <div ng-if="campaign.type === 'recurring'">
            <h2>Options for a Recurring Campaign:</h2>
          </div>

          <div ng-if="campaign.type === 'trigger'">
            <h2>Options for a Trigger Campaign:</h2>

            <div class="form-group">
              <label for="inputEmail" class="col-lg-2 control-label">Trigger Delay (seconds)</label>
              <div class="col-lg-10">
                <input type="number" min="0" class="form-control" ng-model="campaign.triggerDelay">
              </div>
            </div>            

            <table class="table table-striped table-hover">

              <thead>
                <tr>
                  <th>Event Key</th>
                  <th>Match</th>
                </tr>
              </thead>

              <tbody ng-repeat="(key, value) in campaign.triggerEventMatch">
                <tr>
                  <td>
                    <span ng-click="deleteTriggerEventMatch(key)" class="glyphicon glyphicon-remove">&nbsp;</span> {{ key }}
                  </td>
                  <td>
                      <span class="glyphicon glyphicon-edit">&nbsp;</span><input ng-model="campaign.triggerEventMatch[key]" type="text" style="width:90%" >
                  </td>
                </tr>
              </tbody>

            </table>

            <div class="row">
              <form class="form-horizontal" ng-submit="AddTriggerEventMatch()">
                <div class="col-md-12">
                  <h3>Add an Event Key:</h3>
                </div>

                <div class="col-md-12">
                  <label class="control-label">Event Key</label>
                  <input type="text" class="form-control" id="newKey" placeholder="type" ng-model="newTriggerEventMatch.key">
                </div>

                <div class="col-md-12">
                  <label class="control-label">Match</label>
                  <input type="text" class="form-control" id="newKey" placeholder="person_created" ng-model="newTriggerEventMatch.match">
                </div>

                <div class="col-md-2">
                  <label class="control-label">&nbsp;</label>
                  <button type="submit" class="form-control btn btn-primary">Add</button>
                </div>

              </form>
            </div>

          </div>
        </div>
      </div>

      <hr />

      <h2>Preview:</h2>
      <div ng-if="template.url.indexOf('undefined') < 0">
        <p>personGuid: <input type="text" ng-model="renderOptions.personGuid"> Link: <input ng-model="template.url" readonly></input></p>
        <hr />
        <iframe id="templateRenderFrameSmall" ng-src="{{ template.url }}" scrolling="no" frameborder="0" onLoad="MESSAGEBOT.utils.iframeResizeToFit('templateRenderFrameSmall')"></iframe>
      </div>

    </div>

  </row>

</div>
